# NOTE: each dependency may have an optional image prepare settings and a list of containers.
# There are optional source or registry path to overwrite for helm and/or to prepared images
# (retag and push to ECR). It also can provide helm values override paths for image/tag data
# (mandatory when prepare images requested).
# Example:
# - name: foo-charts
#   # If not requested, the optional registry data will get overwritten for helm values
#   # with the value specified for each container, alongside the image and tag values.
#   # When requested, the registry data used as a source only, so its helm value will
#   # be rewritten with a ECR repo path prepared for each container.
#   ecr_prepare_images: true
#
#   # (optinal) extra settings for managed ECR repos
#   ecr_immutable_tag: false
#   ecr_scan_on_push: false
#   ecr_encryption_type: KMS
#   ecr_kms_key: my-kms-key
#
#   # foo-charts specific paths to override with helm set CLI (performs deep-merge)
#   containers:
#     # This results in custom.io/prod/foo:v1.1 pulled, retagged as <ECR repo>/foo:v1.1,
#     # pushed to ECR, then rewritten via helm set overrides CLI
#     app.foo.spec.containers.frontend:
#       name:
#         uri: foo # sets image for helm as app.foo.spec.containers.frontend.uri
#       ver:
#         version: v1.1 # sets tag for helm as app.foo.spec.containers.frontend.version
#       # path to rewrite, also a source to pull from to prepare images
#       registry:
#         # rewrites app.foo.spec.containers.frontend.repository, which takes
#         # <ECR repo> path, when prepared for the image, or custom.io/prod - if not.
#         repository: custom.io/prod
#
#       # ignored, if no prepare images requested, or above registry data provided.
#       # use this instead of 'registry', if image name helm value already includes the
#       # registry path, and there is no registry value for helm. Then the registry path
#       # in the name will get overwritten by the prepared ECR repositroy replacing this
#       # src value there.
#       # NOTE: to rewrite helm 'source' value, define it as {registry: {source: ...}}
#       source: custom.io/prod  # cannot end with a slash /
#
#     # Images cannot be prepared for those due to incomplete data
#     tools.image:
#       # cannot prepare it as the tag and registry helm values defaults are unknown.
#       # helm will have overriden with <some registry>/bar:<some tag>
#       name:
#         image: bar # sets image for helm as tools.image.image
#
#     extra.image:
#       # cannot prepare it as the name and registry helm values defaults are unknown.
#       # helm will have overriden with <some registry>/<some image>:123
#       ver:
#         tag: 123 # sets tag for helm as extra.image.tag
#
#     extra2.image:
#       # cannot prepare it because the helm default tag is unknown.
#       name:
#         image_uri: custom.io/dev/baz  # image path gets rewritten for registry.repository, based on below pattern
#       source: custom.io/dev  # will be ignored
#
apiVersion: v2
name: Handle terraform-kubernetes-addons helm chart dependencies update
version: 1.0.0
dependencies:
  - name: admiralty
    version: 0.13.2
    repository: https://charts.admiralty.io
  - name: secrets-store-csi-driver
    version: 1.2.4
    repository: https://kubernetes-sigs.github.io/secrets-store-csi-driver/charts
  - name: aws-ebs-csi-driver
    version: 2.11.1
    repository: https://kubernetes-sigs.github.io/aws-ebs-csi-driver  # FIXME: deadlink
  - name: aws-efs-csi-driver
    version: 2.2.8
    repository: https://kubernetes-sigs.github.io/aws-efs-csi-driver # FIXME: deadlink
  - name: aws-for-fluent-bit
    version: 0.1.21
    repository: https://aws.github.io/eks-charts
  - name: aws-load-balancer-controller
    version: 1.4.5
    repository: https://aws.github.io/eks-charts
    containers:
      image:
        name:
          repository: docker.io/amazon/aws-alb-ingress-controller
        ver:
          tag: v2.4.3
        source: docker.io/amazon
  - name: aws-node-termination-handler
    version: 0.19.3
    repository: https://aws.github.io/eks-charts
  - name: aws-calico
    version: 0.3.11
    repository: https://aws.github.io/eks-charts
  - name: cert-manager
    version: v1.9.1
    repository: https://charts.jetstack.io # NOTE: redirects to https://artifacthub.io/packages/helm/cert-manager/cert-manager
  - name: cert-manager-csi-driver
    version: v0.4.2
    repository: https://charts.jetstack.io  # https://artifacthub.io/packages/helm/cert-manager/cert-manager-csi-driver
  - name: cluster-autoscaler
    version: 9.21.0
    repository: https://kubernetes.github.io/autoscaler # NOTE: link does not open in a browser, is this fine?
  - name: external-dns
    version: 1.11.0
    repository: https://kubernetes-sigs.github.io/external-dns/
  - name: flux
    version: 1.13.3
    repository: https://charts.fluxcd.io
  - name: ingress-nginx
    version: 4.3.0
    repository: https://kubernetes.github.io/ingress-nginx
    containers:
      controller.admissionWebhooks.patch.image:
        name:
          image: ingress-nginx/kube-webhook-certgen
        tag:
          tag: v1.1.1
        registry:
          registry: registry.k8s.io
      defaultBackend.image:
        name:
          image: defaultbackend-amd64
        ver:
          tag: "1.5"
        registry:
          registry: registry.k8s.io
      controller.image:
        name:
          image: ingress-nginx/controller
        ver:
          tag: v1.0.4
        registry:
          registry: registry.k8s.io
  - name: istio-operator
    version: 1.7.0
    repository: https://clusterfrak-dynamics.github.io/istio/ # FIXME: dead link
  - name: k8gb
    version: v0.9.0
    repository: https://www.k8gb.io
  - name: karma
    version: 1.7.2
    repository: https://charts.helm.sh/stable
  - name: keda
    version: 2.8.2
    repository: https://kedacore.github.io/charts
  - name: keycloak
    version: 18.3.0
    repository: https://codecentric.github.io/helm-charts # https://github.com/codecentric/helm-charts
  - name: kong
    version: 2.13.1
    repository: https://charts.konghq.com
  - name: kube-prometheus-stack
    version: 40.3.1
    repository: https://prometheus-community.github.io/helm-charts
  - name: kyverno
    version: v2.5.3
    repository: https://kyverno.github.io/kyverno/
  - name: kyverno-crds
    version: v2.0.3
    repository: https://kyverno.github.io/kyverno/
  - name: linkerd2
    repository: https://helm.linkerd.io/edge # FIXME: dead link
    version: 21.12.3
  - name: linkerd2-cni
    repository: https://helm.linkerd.io/edge # FIXME: dead link
    version: 21.12.4
  - name: linkerd-viz
    repository: https://helm.linkerd.io/edge # FIXME: dead link
    version: 21.12.4
  - name: loki-stack
    version: 2.8.3
    repository: https://grafana.github.io/helm-charts
  - name: loki
    version: 3.2.0
    repository: https://grafana.github.io/helm-charts
  - name: promtail
    version: 6.4.0
    repository: https://grafana.github.io/helm-charts
  - name: metrics-server
    version: 3.8.2
    repository: https://kubernetes-sigs.github.io/metrics-server/
  - name: node-problem-detector
    version: 2.2.6
    repository: https://charts.deliveryhero.io/
  - name: prometheus-adapter
    version: 3.4.0
    repository: https://prometheus-community.github.io/helm-charts
  - name: prometheus-cloudwatch-exporter
    version: 0.21.0
    repository: https://prometheus-community.github.io/helm-charts
  - name: prometheus-blackbox-exporter
    version: 7.1.0
    repository: https://prometheus-community.github.io/helm-charts
  - name: rabbitmq-cluster-operator
    version: 3.1.0
    repository: https://charts.bitnami.com/bitnami
  - name: scaleway-webhook
    version: v0.0.1
    repository: https://particuleio.github.io/charts # FIXME: dead link
  - name: sealed-secrets
    version: 2.6.9
    repository: https://bitnami-labs.github.io/sealed-secrets
  - name: strimzi-kafka-operator
    version: 0.31.1
    repository: https://strimzi.io/charts/ # FIXME: dead link
  - name: thanos
    version: 11.5.3
    repository: https://charts.bitnami.com/bitnami
  - name: tigera-operator
    version: v3.24.1
    repository: https://docs.projectcalico.org/charts # Access denied
    containers:
      tigeraOperator:
        name:
          image: tigera/operator
        ver:
          version: master
        registry:
          registry: quay.io
      calicoctl:
        name:
          image: docker.io/calico/ctl
        ver:
          tag: master
        source: docker.io
  - name: traefik
    version: 10.30.1
    repository: https://helm.traefik.io/traefik
  - name: memcached
    version: 6.2.5
    repository: https://charts.bitnami.com/bitnami
  - name: vault
    version: 0.22.0
    repository: https://helm.releases.hashicorp.com
  - name: velero
    version: 2.31.8
    repository: https://vmware-tanzu.github.io/helm-charts
  - name: victoria-metrics-k8s-stack
    version: 0.12.4
    repository: https://victoriametrics.github.io/helm-charts/
  - name: testrtc-speedtest
    version: 0.1.0
    repository: https://bogdando.github.io/helm-charts/
  - name: csi-external-snapshotter # Not helm, image prep data only
    # https://github.dev/kubernetes-csi/external-snapshotter
    containers:
      csi-provisioner:
        name:
          repository: k8s.gcr.io/sig-storage/csi-provisioner
        ver:
          tag: v3.2.1
        source: k8s.gcr.io/sig-storage
      csi-snapshotter:
        name:
          repository: gcr.io/k8s-staging-sig-storage/csi-snapshotter
        ver:
          tag: v6.0.1
        source: gcr.io/k8s-staging-sig-storage
      hostpath:
        name:
          repository: k8s.gcr.io/sig-storage/hostpathplugin
        ver:
          tag: v1.8.0
        source: k8s.gcr.io
