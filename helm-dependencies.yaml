# NOTE: each dependency may have an optional registry and image prepare settings for containers.
# The former contains registry value overwrite path, which can be also used as a destination registry
# for prepared images, if requested.
# The latter provides helm values override paths for image/tag data.
# When requested to prepare images (pull from src, retag, push to dst), it also may contain 'registry'
# key containing the source registry to pull from, for each container being prepared.
# Example:
# - name: foo-charts
#   # omit it, if no need to rewrite containers registries paths, nor prepare images
#   registry:
#     # key name path to override containers registry, e.g. tools.image.repository,
#     # if requested to do so, and/or to push prepared images to that destination
#     repository: custom.io/prod
#
#   # NOTE: unsetting both flags, makes the above registry data ignored
#   # if unset, no pull/retag/push will be happening for images
#   prepare_images: true  # requested to prepare images
#
#   # if unset, containers will not take helm set overrides for repository paths
#   rewrite: true         # requested to rewrite the containers registry paths
#
#   containers:
#     # foo-charts specific paths to override with helm set CLI (performs deep-merge)
#     app.foo.spec.containers.frontend:
#       # results in custom.io/dev/foo:v.1.1 pulled, retagged as custom.io/prod/foo:v1.1,
#       # pushed, then rewritten via helm set overrides CLI
#       uri: foo            # image set from helm as app.foo.spec.containers.frontend.uri
#       ver: v1.1           # tag set for helm as app.foo.spec.containers.frontend.ver
#
#       # source to pull from, helm override will be instead set as:
#       # app.foo.spec.containers.frontend.repository: custom.io/prod
#       registry: custom.io/dev
#
#     tools.image:
#       # cannot retag and push it as the tag and src registry defaults are not known here.
#       # helm will use custom.io/prod/bar:v1.2.3, if tools.image.tag takes v1.2.3 from the charts values
#       # and if prepare_images unset. Otherwise (prepare_images: true), would use default values for registry and tag
#       image: bar
#
#     extra.image:
#       tag: 123 # only overwrites the image tag, keeping its name and registry unchanged
#
#     extra2.image:
#       # cannot prepare it because the helm default tag is unknown.
#       # helm will use custom.io/prod/baz:v1.2.3, given that extra2.image.tag takes v1.2.3 from the charts vaues
#       image_uri: custom.io/dev/baz  # image path gets rewritten for registry.repository, based on below pattern
#       # is ignored, extra2.image.repository will instead become overwritten as requested
#       registry: custom.io/dev  # also specifies the registry path rewrite pattern for image_uri
#
apiVersion: v2
name: Handle terraform-kubernetes-addons helm chart dependencies update
version: 1.0.0
dependencies:
  - name: admiralty
    version: 0.13.2
    repository: https://charts.admiralty.io
  - name: secrets-store-csi-driver
    version: 1.2.4
    repository: https://kubernetes-sigs.github.io/secrets-store-csi-driver/charts
  - name: aws-ebs-csi-driver
    version: 2.11.1
    repository: https://kubernetes-sigs.github.io/aws-ebs-csi-driver  # FIXME: deadlink
  - name: aws-efs-csi-driver
    version: 2.2.8
    repository: https://kubernetes-sigs.github.io/aws-efs-csi-driver # FIXME: deadlink
  - name: aws-for-fluent-bit
    version: 0.1.21
    repository: https://aws.github.io/eks-charts
  - name: aws-load-balancer-controller
    version: 1.4.5
    repository: https://aws.github.io/eks-charts
    containers:
      image:
        repository: 602401143452.dkr.ecr.us-west-2.amazonaws.com/amazon/aws-load-balancer-controller
        tag: v2.4.2
        registry: 602401143452.dkr.ecr.us-west-2.amazonaws.com/amazon
  - name: aws-node-termination-handler
    version: 0.19.3
    repository: https://aws.github.io/eks-charts
  - name: aws-calico
    version: 0.3.11
    repository: https://aws.github.io/eks-charts
  - name: cert-manager
    version: v1.9.1
    repository: https://charts.jetstack.io # NOTE: redirects to https://artifacthub.io/packages/helm/cert-manager/cert-manager
  - name: cert-manager-csi-driver
    version: v0.4.2
    repository: https://charts.jetstack.io  # https://artifacthub.io/packages/helm/cert-manager/cert-manager-csi-driver
  - name: cluster-autoscaler
    version: 9.21.0
    repository: https://kubernetes.github.io/autoscaler # NOTE: link does not open in a browser, is this fine?
  - name: external-dns
    version: 1.11.0
    repository: https://kubernetes-sigs.github.io/external-dns/
  - name: flux
    version: 1.13.3
    repository: https://charts.fluxcd.io
  - name: ingress-nginx
    version: 4.3.0
    repository: https://kubernetes.github.io/ingress-nginx
    containers:
      controller.admissionWebhooks.patch.image:
        image: ingress-nginx/kube-webhook-certgen
        tag: v1.1.1
        registry: registry.k8s.io
      defaultBackend.image:
        image: defaultbackend-amd64
        tag: "1.5"
        registry: registry.k8s.io
      controller.image:
        image: ingress-nginx/controller
        tag: v1.0.4
        registry: registry.k8s.io
  - name: istio-operator
    version: 1.7.0
    repository: https://clusterfrak-dynamics.github.io/istio/ # FIXME: dead link
  - name: k8gb
    version: v0.9.0
    repository: https://www.k8gb.io
  - name: karma
    version: 1.7.2
    repository: https://charts.helm.sh/stable
  - name: keda
    version: 2.8.2
    repository: https://kedacore.github.io/charts
  - name: keycloak
    version: 18.3.0
    repository: https://codecentric.github.io/helm-charts # https://github.com/codecentric/helm-charts
  - name: kong
    version: 2.13.1
    repository: https://charts.konghq.com
  - name: kube-prometheus-stack
    version: 40.3.1
    repository: https://prometheus-community.github.io/helm-charts
  - name: kyverno
    version: v2.5.3
    repository: https://kyverno.github.io/kyverno/
  - name: kyverno-crds
    version: v2.0.3
    repository: https://kyverno.github.io/kyverno/
  - name: linkerd2
    repository: https://helm.linkerd.io/edge # FIXME: dead link
    version: 21.12.3
  - name: linkerd2-cni
    repository: https://helm.linkerd.io/edge # FIXME: dead link
    version: 21.12.4
  - name: linkerd-viz
    repository: https://helm.linkerd.io/edge # FIXME: dead link
    version: 21.12.4
  - name: loki-stack
    version: 2.8.3
    repository: https://grafana.github.io/helm-charts
  - name: loki
    version: 3.2.0
    repository: https://grafana.github.io/helm-charts
  - name: promtail
    version: 6.4.0
    repository: https://grafana.github.io/helm-charts
  - name: metrics-server
    version: 3.8.2
    repository: https://kubernetes-sigs.github.io/metrics-server/
  - name: node-problem-detector
    version: 2.2.6
    repository: https://charts.deliveryhero.io/
  - name: prometheus-adapter
    version: 3.4.0
    repository: https://prometheus-community.github.io/helm-charts
  - name: prometheus-cloudwatch-exporter
    version: 0.21.0
    repository: https://prometheus-community.github.io/helm-charts
  - name: prometheus-blackbox-exporter
    version: 7.1.0
    repository: https://prometheus-community.github.io/helm-charts
  - name: rabbitmq-cluster-operator
    version: 3.1.0
    repository: https://charts.bitnami.com/bitnami
  - name: scaleway-webhook
    version: v0.0.1
    repository: https://particuleio.github.io/charts # FIXME: dead link
  - name: sealed-secrets
    version: 2.6.9
    repository: https://bitnami-labs.github.io/sealed-secrets
  - name: strimzi-kafka-operator
    version: 0.31.1
    repository: https://strimzi.io/charts/ # FIXME: dead link
  - name: thanos
    version: 11.5.3
    repository: https://charts.bitnami.com/bitnami
  - name: tigera-operator
    version: v3.24.1
    repository: https://docs.projectcalico.org/charts # Access denied
  - name: traefik
    version: 10.30.1
    repository: https://helm.traefik.io/traefik
  - name: memcached
    version: 6.2.5
    repository: https://charts.bitnami.com/bitnami
  - name: vault
    version: 0.22.0
    repository: https://helm.releases.hashicorp.com
  - name: velero
    version: 2.31.8
    repository: https://vmware-tanzu.github.io/helm-charts
  - name: victoria-metrics-k8s-stack
    version: 0.12.4
    repository: https://victoriametrics.github.io/helm-charts/
  - name: testrtc-speedtest
    version: 0.1.0
    repository: https://bogdando.github.io/helm-charts/