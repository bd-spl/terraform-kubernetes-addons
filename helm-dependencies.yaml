# NOTE: Each dependency may have containers data to prepare images for use in private
# EKS clusters. Skopeo will copy images from the given source/registry into ensured ECR.
# There are source/registry paths used to overwrite for helm and/or to prepared images.
# It also can provide helm values override paths for image/tag data. For addons not
# managed with helm_release, but kubectl_manifest, you can still provide containers data.
#
# Example:
# - name: foo-addon-charts
#   containers:
#     # This results in custom.io/prod/foo:v1.1 copied as <ECR repo>/foo:v1.1,
#     # then its helm values updated via the 'helm set' interface
#     app.foo.spec.containers.frontend:
#       name:
#         uri: foo # sets image for helm as app.foo.spec.containers.frontend.uri
#       ver:
#         version: v1.1 # sets tag for helm as app.foo.spec.containers.frontend.version
#
#       # Optional ECR settings (not for helm), override the addons module vars
#       ecr_immutable_tag: false
#       ecr_scan_on_push: false
#       ecr_encryption_type: KMS
#       ecr_kms_key: my-kms-key
#
#       # Either to prepare images in ECR, or just override the helm values.
#       # Disabling it makes the 'source' data ignored. The name/registry values
#       # then end up in helm as provided (i.e. no paths rewriting for ECR)
#       ecr_prepare_images: true
#
#       # Assumes the 'name' holds a shortname instead of URI.
#       # When 'source' is unset, skopeo_copy takes this as a source, and ECR as a dst.
#       # Helm takes the prepared ECR repo URL value, or the original value, if
#       # 'ecr_prepare_images' was disabled.
#       registry:
#         # sets registry for helm as app.foo.spec.containers.frontend.repository,
#         # based on ecr_prepare_images enabled, or not
#         repository: custom.io/prod # used as a source only, or as a final value
#
#       # Ignored when ecr_prepare_images is off.
#       # Use this instead of 'registry', if image name helm value already includes the
#       # registry path, and there is no registry value for helm. Then the registry path
#       # in the name will get overwritten by the prepared ECR repositroy replacing this
#       # src value there.
#       # NOTE: to rewrite helm 'source' value, define it as {registry: {source: ...}}
#       source: custom.io/prod  # cannot end with a slash /
#
#     extra.image:
#       # Has ecr_prepare_images enabled by default
#       name:
#         # NOTE: the registry path part of URI must be the same as in the source, e.g.:
#         # custom.io, or custom.io/dev (depending on a use case and namespace)
#         image_uri: custom.io/dev/baz # Helm takes prepared <ECR>/dev/baz:latest
#       source: custom.io  # skopeo copies it from custom.io/dev/baz:latest to ECR
#
#     sidecar.spec.containers:
#       # Helm will use custom.io/dev/qux:<whatever tag it defines>
#       ecr_prepare_images: false
#       name:
#         image: dev/qux # sets image for helm as sidecar.spec.containers.image
#       registry: # sets helm to use sidecar.spec.containers.source registry as provided
#         source: custom.io
#       source: custom.io/prod  # will be ignored as ecr_prepare_images is off!
#
#      bad.example:
#        # 'registry' will be ignored when preparing images,
#        # but helm will take both rewritten registry and uri paths,
#        # which might result in a misconfigured chart (repo info looks redundant here)
#        name:
#          uri: custom.io/quux:v123  # helm takes <ECR>/quux:v123
#        registry:
#          repo: custom.io/prod      # helm takes <ECR>/prod?..
#        source: custom.io
#
apiVersion: v2
name: Handle terraform-kubernetes-addons helm chart dependencies update
version: 1.0.0
dependencies:
  - name: admiralty
    version: 0.13.2
    repository: https://charts.admiralty.io
  - name: secrets-store-csi-driver
    version: 1.2.4
    repository: https://kubernetes-sigs.github.io/secrets-store-csi-driver/charts
  - name: aws-ebs-csi-driver
    version: 2.11.1
    repository: https://kubernetes-sigs.github.io/aws-ebs-csi-driver  # FIXME: deadlink
    containers:
      image:
        name:
          repository: docker.io/amazon/aws-ebs-csi-driver
        ver:
          tag: v1.6.2
        source: docker.io/amazon
      sidecars.provisioner:
        name:
          image: k8s.gcr.io/sig-storage/csi-provisioner
        ver:
          tag: v3.1.0
        source: k8s.gcr.io/sig-storage
      sidecars.attacher:
        name:
          image: k8s.gcr.io/sig-storage/csi-attacher
        ver:
          tag: v3.4.0
        source: k8s.gcr.io/sig-storage
      sidecars.snapshotter:
        name:
          image: k8s.gcr.io/sig-storage/csi-snapshotter
        ver:
          tag: v6.0.1
        source: k8s.gcr.io/sig-storage
      sidecars.livenessProbe:
        name:
          image: k8s.gcr.io/sig-storage/livenessprobe
        ver:
          tag: v2.6.0
        source: k8s.gcr.io
      sidecars.resizer:
        name:
          image: k8s.gcr.io/sig-storage/csi-resizer
        ver:
          tag: v1.4.0
        source: k8s.gcr.io/sig-storage
      sidecars.nodeDriverRegistrar:
        name:
          image: k8s.gcr.io/sig-storage/csi-node-driver-registrar
        ver:
          tag: v2.5.1
        source: k8s.gcr.io/sig-storage
  - name: aws-efs-csi-driver
    version: 2.2.8
    repository: https://kubernetes-sigs.github.io/aws-efs-csi-driver # FIXME: deadlink
  - name: aws-for-fluent-bit
    version: 0.1.21
    repository: https://aws.github.io/eks-charts
  - name: aws-load-balancer-controller
    version: 1.4.5
    repository: https://aws.github.io/eks-charts
    containers:
      image:
        name:
          repository: docker.io/amazon/aws-alb-ingress-controller
        ver:
          tag: v2.4.3
        source: docker.io/amazon
  - name: aws-node-termination-handler
    version: 0.19.3
    repository: https://aws.github.io/eks-charts
  - name: aws-calico
    version: 0.3.11
    repository: https://aws.github.io/eks-charts
  - name: cert-manager
    version: v1.9.1
    repository: https://charts.jetstack.io # NOTE: redirects to https://artifacthub.io/packages/helm/cert-manager/cert-manager
  - name: cert-manager-csi-driver
    version: v0.4.2
    repository: https://charts.jetstack.io  # https://artifacthub.io/packages/helm/cert-manager/cert-manager-csi-driver
  - name: cluster-autoscaler
    version: 9.21.0
    repository: https://kubernetes.github.io/autoscaler # NOTE: link does not open in a browser, is this fine?
  - name: external-dns
    version: 1.11.0
    repository: https://kubernetes-sigs.github.io/external-dns/
  - name: flux
    version: 1.13.3
    repository: https://charts.fluxcd.io
  - name: ingress-nginx
    version: 4.3.0
    repository: https://kubernetes.github.io/ingress-nginx
    containers:
      controller.admissionWebhooks.patch.image:
        name:
          image: ingress-nginx/kube-webhook-certgen
        ver:
          tag: v1.1.1
        registry:
          registry: registry.k8s.io
      defaultBackend.image:
        name:
          image: defaultbackend-amd64
        ver:
          tag: "1.5"
        registry:
          registry: registry.k8s.io
      controller.image:
        name:
          image: ingress-nginx/controller
        ver:
          tag: v1.0.4
        registry:
          registry: registry.k8s.io
  - name: istio-operator
    version: 1.7.0
    repository: https://clusterfrak-dynamics.github.io/istio/ # FIXME: dead link
  - name: k8gb
    version: v0.9.0
    repository: https://www.k8gb.io
  - name: karma
    version: 1.7.2
    repository: https://charts.helm.sh/stable
  - name: keda
    version: 2.8.2
    repository: https://kedacore.github.io/charts
  - name: keycloak
    version: 18.3.0
    repository: https://codecentric.github.io/helm-charts # https://github.com/codecentric/helm-charts
  - name: kong
    version: 2.13.1
    repository: https://charts.konghq.com
  - name: kube-prometheus-stack
    version: 40.3.1
    repository: https://prometheus-community.github.io/helm-charts
  - name: kyverno
    version: v2.5.3
    repository: https://kyverno.github.io/kyverno/
  - name: kyverno-crds
    version: v2.0.3
    repository: https://kyverno.github.io/kyverno/
  - name: linkerd2
    repository: https://helm.linkerd.io/edge # FIXME: dead link
    version: 21.12.3
  - name: linkerd2-cni
    repository: https://helm.linkerd.io/edge # FIXME: dead link
    version: 21.12.4
  - name: linkerd-viz
    repository: https://helm.linkerd.io/edge # FIXME: dead link
    version: 21.12.4
  - name: loki-stack
    version: 2.8.3
    repository: https://grafana.github.io/helm-charts
  - name: loki
    version: 3.2.0
    repository: https://grafana.github.io/helm-charts
  - name: promtail
    version: 6.4.0
    repository: https://grafana.github.io/helm-charts
  - name: metrics-server
    # https://github.dev/kubernetes-sigs/metrics-server
    version: 3.8.2
    repository: https://kubernetes-sigs.github.io/metrics-server/
    containers:
      image:
        name:
          repository: k8s.gcr.io/metrics-server/metrics-server
        source: k8s.gcr.io/metrics-server
  - name: node-problem-detector
    version: 2.2.6
    repository: https://charts.deliveryhero.io/
    containers:
      image:
        name:
          repository: k8s.gcr.io/node-problem-detector/node-problem-detector
        ver:
          tag: v0.8.10
        source: k8s.gcr.io/node-problem-detector
  - name: prometheus-adapter
    version: 3.4.0
    repository: https://prometheus-community.github.io/helm-charts
  - name: prometheus-cloudwatch-exporter
    version: 0.21.0
    repository: https://prometheus-community.github.io/helm-charts
  - name: prometheus-blackbox-exporter
    version: 7.1.0
    repository: https://prometheus-community.github.io/helm-charts
  - name: rabbitmq-cluster-operator
    version: 3.1.0
    repository: https://charts.bitnami.com/bitnami
  - name: scaleway-webhook
    version: v0.0.1
    repository: https://particuleio.github.io/charts # FIXME: dead link
  - name: sealed-secrets
    version: 2.6.9
    repository: https://bitnami-labs.github.io/sealed-secrets
  - name: strimzi-kafka-operator
    version: 0.31.1
    repository: https://strimzi.io/charts/ # FIXME: dead link
  - name: thanos
    version: 11.5.3
    repository: https://charts.bitnami.com/bitnami
  - name: tigera-operator
    version: v3.24.1
    repository: https://docs.projectcalico.org/charts # Access denied
    containers:
      tigeraOperator:
        name:
          image: tigera/operator
        ver:
          version: master
        registry:
          registry: quay.io
      calicoctl:
        name:
          image: docker.io/calico/ctl
        ver:
          tag: master
        source: docker.io
  - name: traefik
    version: 10.30.1
    repository: https://helm.traefik.io/traefik
  - name: memcached
    version: 6.2.5
    repository: https://charts.bitnami.com/bitnami
  - name: vault
    version: 0.22.0
    repository: https://helm.releases.hashicorp.com
  - name: velero
    version: 2.31.8
    repository: https://vmware-tanzu.github.io/helm-charts
  - name: victoria-metrics-k8s-stack
    version: 0.12.4
    repository: https://victoriametrics.github.io/helm-charts/
  - name: testrtc-speedtest
    version: 0.1.0
    repository: https://bogdando.github.io/helm-charts/
  - name: csi-external-snapshotter # Not helm, image prep data only
    # https://github.dev/kubernetes-csi/external-snapshotter
    containers:
      csi-provisioner:
        name:
          repository: k8s.gcr.io/sig-storage/csi-provisioner
        ver:
          tag: v3.2.1
        source: k8s.gcr.io/sig-storage
      csi-snapshotter:
        name:
          repository: gcr.io/k8s-staging-sig-storage/csi-snapshotter
        ver:
          tag: v6.0.1
        source: gcr.io/k8s-staging-sig-storage
      hostpath:
        name:
          repository: k8s.gcr.io/sig-storage/hostpathplugin
        ver:
          tag: v1.8.0
        source: k8s.gcr.io
